#!/bin/bash

################################################################################
# pipeline to build data for structure-property training and evaluation
#
# should be run from this directory
#
# (C) 2020 Bryan Kolaczkowski, University of Florida, Gainesville, FL USA
# Released under GNU General Public License (GPL)
# bryank@ufl.edu
################################################################################

# where to put all the data
OUTDIR=../data

# 1. get dssp properties for all current entries in PDB
# NOTE: this will take a day or more
#./getPDBdata -o ${OUTDIR}/pdbdata-strctinfo --exclude ${OUTDIR}/exclude_ids.txt

# 2. cluster PDB sequences by sequence identity
# NOTE: this will take a few minutes
#./clustPDBdata --seqid 0.1 -d ${OUTDIR}/pdbdata-strctinfo -o ${OUTDIR}/clusters.csv

# 3. split PDB data into training, validate and testing data
# NOTE: this will take a moment
#./splitPDBdata -c ${OUTDIR}/clusters.csv -o ${OUTDIR}/tvtsplit.txt > ${OUTDIR}/tvtsplit.log

# 4. calculate frequencies of each secondary structure in the training data
# NOTE: this will take a few minutes
#./calcTrainWts -f ${OUTDIR}/tvtsplit.txt -d ${OUTDIR}/pdbdata-strctinfo -o ${OUTDIR}/tvtsplit.trainwts.txt

# 5. generate fasta file for structure data from pdb
# NOTE: this will take a few minutes
#./makePDBfasta -d ${OUTDIR}/pdbdata-strctinfo -o ${OUTDIR}/pdbdata-strctinfo.fasta

# 6. convert fasta file to mmseqs2 query database
# NOTE: this will take a moment
mmseqs createdb ${OUTDIR}/pdbdata-strctinfo.fasta ${OUTDIR}/pdbdata-strctinfo.db --createdb-mode 1

